@model Uiftec.PPW.Redesocial.Models.FeedViewModel

@{
    ViewData["Title"] = "Feed";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

<div class="container mt-4">
    @if (TempData["Mensagem"] != null)
    {
        <div class="alert alert-success">@TempData["Mensagem"]</div>
    }

    @if (TempData["Erro"] != null)
    {
        <div class="alert alert-danger">@TempData["Erro"]</div>
    }

    <h2>Bem-vindo, @(Model.UsuarioAtivo?.Nome ?? "Usuário")!</h2>

    <!-- Stories -->
    @if (Model.StoriesExternos?.Any() == true)
    {
        <div class="mb-4">
            <h5>Stories</h5>
            <div class="d-flex">
                @foreach (var story in Model.StoriesExternos)
                {
                    <div class="text-center mr-2">
                        <img src="@story.ImagemUrl" class="rounded-circle" style="width:80px;height:80px;" />
                       
                    </div>
                }
            </div>
        </div>
    }

    <!-- Novo Post -->
    <form asp-action="Criar" method="post">
        <textarea name="TextoPost" class="form-control mb-2" placeholder="No que você está pensando?"></textarea>
        <button class="btn btn-primary">Postar</button>
    </form>

    <!-- Feed de Posts -->
    @foreach (var post in Model.Postagens.OrderByDescending(p => p.date))
    {
        var autor = Model.Usuarios.FirstOrDefault(u => u.ID == post.UserId);
        <div class="card mt-4">
            <div class="card-body">
                <div class="media">
                    <img src="@autor?.FotoPerfil" class="mr-3 rounded-circle" style="width:60px;height:60px;" />
                    <div class="media-body">
                        <h5>@autor?.Nome <small class="text-muted">@post.date.ToString("dd/MM/yyyy HH:mm")</small></h5>
                        <p>@post.TextPreview</p>
                        <div>
                            <form asp-action="Curtir" method="post" style="display:inline;">
                                <input type="hidden" name="idPost" value="@post.Id" />
                                <button type="submit" class="btn btn-link p-0"><i class="fa fa-thumbs-up"></i> @post.LikeCount</button>
                            </form>
                            <span class="ml-3"><i class="fa fa-comments"></i> @post.CommentCount</span>
                        </div>
                    </div>
                </div>

                

                <!-- Formulário de Comentário -->
                <form asp-action="Comentar" method="post" class="mt-2">
                    <input type="hidden" name="idPost" value="@post.Id" />
                    <textarea name="textoComentario" class="form-control mb-1" rows="2" placeholder="Escreva um comentário..."></textarea>
                    <button class="btn btn-sm btn-outline-primary">Comentar</button>
                </form>
            </div>
        </div>
    }
</div>